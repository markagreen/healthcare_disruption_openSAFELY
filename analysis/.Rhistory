output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# July 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-07-01.csv.gz"))) # Load
input$date <- "2019-07-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# August 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-08-01.csv.gz"))) # Load
input$date <- "2019-08-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# September 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-09-01.csv.gz"))) # Load
input$date <- "2019-09-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# October 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-10-01.csv.gz"))) # Load
input$date <- "2019-10-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# November 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-11-01.csv.gz"))) # Load
input$date <- "2019-11-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# December 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-12-01.csv.gz"))) # Load
input$date <- "2019-12-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# January 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-01-01.csv.gz"))) # Load
input$date <- "2020-01-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# February 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-02-01.csv.gz"))) # Load
input$date <- "2020-02-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# March 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-03-01.csv.gz"))) # Load
input$date <- "2020-03-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# April 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-04-01.csv.gz"))) # Load
input$date <- "2020-04-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# May 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-05-01.csv.gz"))) # Load
input$date <- "2020-05-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# June 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-06-01.csv.gz"))) # Load
input$date <- "2020-06-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# July 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-07-01.csv.gz"))) # Load
input$date <- "2020-07-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# August 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-08-01.csv.gz"))) # Load
input$date <- "2020-08-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# September 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-09-01.csv.gz"))) # Load
input$date <- "2020-09-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# October 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-10-01.csv.gz"))) # Load
input$date <- "2020-10-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# November 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-11-01.csv.gz"))) # Load
input$date <- "2020-11-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# December 2020
input <- read_csv(gsub("analysis", "", here("output/measures","input_2020-12-01.csv.gz"))) # Load
input$date <- "2020-12-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# January 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-01-01.csv.gz"))) # Load
input$date <- "2021-01-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# February 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-02-01.csv.gz"))) # Load
input$date <- "2021-02-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# March 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-03-01.csv.gz"))) # Load
input$date <- "2021-03-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# April 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-04-01.csv.gz"))) # Load
input$date <- "2021-04-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# May 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-05-01.csv.gz"))) # Load
input$date <- "2021-05-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# June 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-06-01.csv.gz"))) # Load
input$date <- "2021-06-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# July 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-07-01.csv.gz"))) # Load
input$date <- "2021-07-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# August 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-08-01.csv.gz"))) # Load
input$date <- "2021-08-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# September 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-09-01.csv.gz"))) # Load
input$date <- "2021-09-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# October 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-10-01.csv.gz"))) # Load
input$date <- "2021-10-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# November 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-11-01.csv.gz"))) # Load
input$date <- "2021-11-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# December 2021
input <- read_csv(gsub("analysis", "", here("output/measures","input_2021-12-01.csv.gz"))) # Load
input$date <- "2021-12-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# January 2022
input <- read_csv(gsub("analysis", "", here("output/measures","input_2022-01-01.csv.gz"))) # Load
input$date <- "2022-01-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# February 2022
input <- read_csv(gsub("analysis", "", here("output/measures","input_2022-02-01.csv.gz"))) # Load
input$date <- "2022-02-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
# March 2022
input <- read_csv(gsub("analysis", "", here("output/measures","input_2022-03-01.csv.gz"))) # Load
input$date <- "2022-03-01" # Add date
source("age_standardise_month.R") # Call age-standardisation script
output_imd <- rbind(output_imd, input_imd) # Add month records to output file (for each)
output_region <- rbind(output_region, input_region)
output_urbrur <- rbind(output_urbrur, input_urbrur)
rm(input_imd, input_region, input_urbrur) # Tidy
summary(output_imd)
write.csv(input_imd, file = gsub("analysis", "", here("output/measures","standardised_imd_trends.csv")))
write.csv(output_imd, file = gsub("analysis", "", here("output/measures","standardised_imd_trends.csv")))
write.csv(output_region, file = gsub("analysis", "", here("output/measures","standardised_region_trends.csv")))
write.csv(output_urbrur, file = gsub("analysis", "", here("output/measures","standardised_urbrur_trends.csv")))
# Load libraries
library(data.table)
library(readr)
library(here)
## 1. Load all data into R and tidy ##
# The code does this individually one month at a time - suggestions for more efficient code welcome!)
# January 2019
input <- read_csv(gsub("analysis", "", here("output/measures","input_2019-01-01.csv.gz"))) # Load
input$date <- "2019-01-01" # Add date
source(here("age_standardise_month.R")) # Call age-standardisation script
here("age_standardise_month.R")
source(here("/analysis/age_standardise_month.R")) # Call age-standardisation script
library(here)
source(here("/analysis/age_standardise_month.R")) # Call age-standardisation script
here("/analysis/age_standardise_month.R")
here("age_standardise_month.R")
here("analysis", "age_standardise_month.R")
source(here("analysis", "age_standardise_month.R"))
here("analysis", "age_standardise_month.R")
# Load data
trends_imd <- read.csv("../output/measures/standardised_imd_trends.csv") # Trends by neighbourhood deprivation
# Libraries
library(ggplot2)
head(trends_imd)
ggplot(trends_imd, aes(x = date, y = iexp_admitted, group = imd_quintile, color = imd_quintile)) +
geom_point() +
facet_wrap(~sex)
ggplot(trends_imd[trends_imd$imd_quintile != 0], aes(x = date, y = iexp_admitted, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = iexp_admitted, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex)
trends_urbrur <- read.csv("../output/measures/standardised_urbrur_trends.csv")
head(trends_urbrur)
ggplot(trends_urbrur[trends_urbrur$urban_rural != 0,], aes(x = date, y = iexp_admitted, group = urban_rural, color = urban_rural)) +
geom_line() +
facet_wrap(~sex)
trends_region <- read.csv("../output/measures/standardised_region_trends.csv")
trends_eth <- read.csv("../output/measures/standardised_ethnicity_trends.csv")
head(trends_eth)
head(trends_region)
table(trends_region$region)
ggplot(trends_region, aes(x = date, y = iexp_admitted, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_eth[trends_eth$ethnicity != 0,], aes(x = date, y = iexp_admitted, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_eth[trends_eth$ethnicity != 0,], aes(x = date, y = iexp_admitted, group = ethnicity, color = ethnicity)) +
geom_line() +
facet_wrap(~sex)
# Plot
# IMD
trends_imd$smr <- trends_imd$admitted / trends_imd$iexp_admitted # SMR
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(breaks = "6 months")
trends_imd$date <- as.Date(trends_imd$date)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(breaks = "6 months")
# trends_imd$dsr_admitted <- (trends_imd$mk / trends_imd$total_pop) * 100000  # Rate (direct)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(breaks = "12 months")
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%Y")
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
# Ethnicity
trends_eth$smr <- trends_eth$admitted / trends_eth$iexp_admitted # SMR (indirect)
ggplot(trends_eth[trends_eth$ethnicity != 0,], aes(x = date, y = smr, group = ethnicity, color = ethnicity)) +
geom_line() +
facet_wrap(~sex)
# Urban v rural
trends_urbrur$smr <- trends_urbrur$admitted / trends_urbrur$iexp_admitted # SMR (indirect)
ggplot(trends_urbrur[trends_urbrur$urban_rural != 0,], aes(x = date, y = smr, group = urban_rural, color = urban_rural)) +
geom_line() +
facet_wrap(~sex)
trends_region$smr <- trends_region$admitted / trends_region$iexp_admitted # SMR (indirect)
ggplot(trends_region, aes(x = date, y = smr, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_region[!is.na(trends_region$region)], aes(x = date, y = smr, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_region[!is.na(trends_region$region),], aes(x = date, y = smr, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)
ggplot(trends_region[!is.na(trends_region$region),], aes(x = date, y = smr, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)  +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_region$date <- as.Date(trends_region$date)
ggplot(trends_region[!is.na(trends_region$region),], aes(x = date, y = smr, group = region, color = region)) +
geom_line() +
facet_wrap(~sex)  +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
table(trends_region$date)
View(trends_region)
names(trends_imd)
trends_imd$smr <- trends_imd$admitted_acs_all / trends_imd$iexp_admitted_acs_all # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$smr <- trends_imd$admitted_acs_acute / trends_imd$iexp_admitted_acs_acute # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$smr <- trends_imd$admitted_acs_chronic / trends_imd$iexp_admitted_acs_chronic # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$smr <- trends_imd$admitted_acs_vaccine / trends_imd$iexp_admitted_acs_vaccine # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$smr <- trends_imd$admitted_eucs / trends_imd$iexp_admitted_eucs # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$sir <- trends_imd$smr * (trends_imd$admitted / trends_imd$pop) # As rate
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = sir, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$smr <- trends_imd$admitted_acs_vaccine / trends_imd$iexp_admitted_acs_vaccine # SMR (indirect)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = smr, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$sir <- trends_imd$smr * (trends_imd$admitted / trends_imd$pop) # As rate
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = sir, group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
install.packages("PHEindicatormethods")
library(PHEindicatormethods)
phe_sii(trends_imd, quantile = imd_quintile, population = pop, x = sir)
trends_imd$smr <- trends_imd$admitted_eucs / trends_imd$iexp_admitted_eucs # SMR (indirect)
trends_imd$sir <- trends_imd$smr * (trends_imd$admitted / trends_imd$pop) # As rate
trends_imd$sir_low <- trends_imd$sir - (1.96 * (sqrt(trends_imd$admitted_eucs)/ trends_imd$iexp_admitted_eucs)) # Lower bound
trends_imd$sir_upp <- trends_imd$sir + (1.96 * (sqrt(trends_imd$admitted_eucs)/ trends_imd$iexp_admitted_eucs)) # Upper bound
head(trends_imd)
test <- phe_sii(data = trends_imd, quantile = imd_quintile, population = pop, x = sir, lower_cl = sir_low, upper_cl = sir_upp)
test <- phe_sii(data = trends_imd, quantile = imd_quintile, population = pop, value = sir, lower_cl = sir_low, upper_cl = sir_upp, confidence = 0.95, rii = TRUE, type = "standard")
test <- phe_sii(data = trends_imd, quantile = imd_quintile, population = pop, value = sir, value_type = 0, lower_cl = sir_low, upper_cl = sir_upp, confidence = 0.95, rii = TRUE, type = "standard")
?phe_sii
head(trends_imd)
test <- phe_sii(data = trends_imd, quantile = imd_quintile, population = pop, value = sir, value_type = 0, lower_cl = sir_low, upper_cl = sir_upp, confidence = 0.95, rii = FALSE, type = "standard")
# Libraries
library(ggplot2)
library(PHEindicatormethods)
# Load data
trends_imd <- read.csv("../output/measures/standardised_imd_trends.csv") # Trends by neighbourhood deprivation
trends_eth <- read.csv("../output/measures/standardised_ethnicity_trends.csv")
trends_urbrur <- read.csv("../output/measures/standardised_urbrur_trends.csv")
trends_region <- read.csv("../output/measures/standardised_region_trends.csv")
install.packages("PHEindicatormethods")
library(PHEindicatormethods)
head(trends_imd)
# Load data
trends_imd <- read.csv("../output/measures/standardised_imd_trends.csv") # Trends by neighbourhood deprivation
head(trends_imd)
trends_imd$sdr_admitted <- (trends_imd$dexp_admitted / trends_imd$pop) * 100000
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = sdr_admitted , group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$date <- as.Date(trends_imd$date)
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = sdr_admitted , group = imd_quintile, color = imd_quintile)) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
ggplot(trends_imd[trends_imd$imd_quintile != 0,], aes(x = date, y = sdr_admitted , group = factor(imd_quintile), color = factor(imd_quintile))) +
geom_line() +
facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
trends_imd$dsr_admitted_low <- trends_imd$sdr_admitted  - (1.96 * (sqrt(input_imd$sdr_admitted ))) # Lower bound
trends_imd$dsr_admitted_upp <- trends_imd$sdr_admitted  + (1.96 * (sqrt(input_imd$sdr_admitted ))) # Upper bound
trends_imd$dsr_admitted_low <- trends_imd$sdr_admitted  - (1.96 * (sqrt(trends_imd$sdr_admitted ))) # Lower bound
trends_imd$dsr_admitted_upp <- trends_imd$sdr_admitted  + (1.96 * (sqrt(trends_imd$sdr_admitted ))) # Upper bound
head(trends_imd)
test <- phe_sii(data = trends_imd, quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test <- phe_sii(data = trends_imd[trends_imd$imd_quintile != 0,], quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
summary(trends_imd)
test <- phe_sii(data = trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted),], quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test <- phe_sii(data = trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01",], quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test <- phe_sii(data = trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01" & trends_imd$sex == "F",], quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test
test <- phe_sii(data = trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01" & trends_imd$sex == "F",], quantile = -(imd_quintile), population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test <- phe_sii(data = group_by(trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01",], sex), quantile = -(imd_quintile), population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
library(dplyr)
test <- phe_sii(data = group_by(trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01",], sex), quantile = -(imd_quintile), population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test <- phe_sii(data = group_by(trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$date == "2021-01-01",], sex), quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test
test <- phe_sii(data = group_by(trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$sex == "M",], date), quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = FALSE, type = "standard")
test
ggplot(males, aes(x = date, y = sii, group = imd_quintile, color = imd_quintile)) +
geom_line() +
#facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
males <- test
ggplot(males, aes(x = date, y = sii, group = imd_quintile, color = imd_quintile)) +
geom_line() +
#facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
ggplot(males, aes(x = date, y = sii)) +
geom_line() +
#facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
males_rii <- phe_sii(data = group_by(trends_imd[trends_imd$imd_quintile != 0 & !is.na(trends_imd$sdr_admitted) & trends_imd$sex == "M",], date), quantile = imd_quintile, population = pop, value = sdr_admitted , value_type = 0, lower_cl = dsr_admitted_low , upper_cl = dsr_admitted_upp, confidence = 0.95, rii = TRUE, type = "standard")
ggplot(males_rii, aes(x = date, y = rii)) +
geom_line() +
#facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
males$sii <- males$sii * -1 # IMD is wrong way around?
ggplot(males, aes(x = date, y = sii)) +
geom_line() +
#facet_wrap(~sex) +
scale_x_date(date_breaks = "6 months", date_labels = "%m-%y")
